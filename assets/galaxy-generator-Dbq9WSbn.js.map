{"version":3,"file":"galaxy-generator-Dbq9WSbn.js","sources":["../../src/projects/galaxy-generator.js"],"sourcesContent":["import GUI from 'lil-gui'\nimport * as THREE from 'three'\nimport { Timer } from 'three/addons/misc/Timer.js'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\n\nexport default function galaxyGenerator(canvas) {\n  /**\n   * Scene\n   */\n  // debug\n  const gui = new GUI({ width: 480 })\n  const scene = new THREE.Scene()\n\n  /**\n   * Sizes\n   */\n  const sizes = {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  }\n\n  const onResize = () => {\n    sizes.width = window.innerWidth\n    sizes.height = window.innerHeight\n\n    camera.aspect = sizes.width / sizes.height\n    camera.updateProjectionMatrix()\n\n    renderer.setSize(sizes.width, sizes.height)\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n  }\n\n  window.addEventListener('resize', onResize)\n\n  /**\n   * Camera\n   */\n  const camera = new THREE.PerspectiveCamera(\n    75,\n    sizes.width / sizes.height,\n    0.1,\n    100,\n  )\n  camera.position.z = 5\n  camera.position.x = 7\n  camera.position.y = 5\n  scene.add(camera)\n\n  /**\n   * Controls\n   */\n  const controls = new OrbitControls(camera, canvas)\n  controls.enableDamping = true\n\n  /**\n   * Renderer\n   */\n  const renderer = new THREE.WebGLRenderer({ canvas })\n  renderer.setSize(sizes.width, sizes.height)\n  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n\n  /**\n   * Galaxy\n   */\n\n  const parameters = {\n    count: 100000,\n    size: 0.02,\n    radius: 5,\n    branches: 4,\n    spin: 1,\n    randomness: 0.2,\n    randomnessPower: 2.5,\n    insideColor: '#ff6030',\n    outsideColor: '#1b3984',\n    rotationSpeed: 0.1,\n  }\n\n  let geometry\n  let material\n  let points\n\n  const generateGalaxy = () => {\n    // clean the old galaxy\n    if (points) {\n      geometry.dispose()\n      material.dispose()\n      scene.remove(points)\n    }\n\n    /**\n     * Geometry\n     */\n    geometry = new THREE.BufferGeometry()\n    const positions = new Float32Array(parameters.count * 3)\n    const colors = new Float32Array(parameters.count * 3)\n\n    const colorInside = new THREE.Color(parameters.insideColor)\n    const colorOutside = new THREE.Color(parameters.outsideColor)\n\n    for (let i = 0; i < parameters.count; i++) {\n      const i3 = i * 3\n      // positions\n      const radius = Math.random() * parameters.radius\n      const spinAngle = radius * parameters.spin\n      const branchAngle =\n        ((i % parameters.branches) / parameters.branches) * Math.PI * 2\n\n      const randomX =\n        Math.pow(Math.random(), parameters.randomnessPower) *\n        (Math.random() < 0.5 ? 1 : -1)\n      const randomY =\n        Math.pow(Math.random(), parameters.randomnessPower) *\n        (Math.random() < 0.5 ? 1 : -1)\n      const randomZ =\n        Math.pow(Math.random(), parameters.randomnessPower) *\n        (Math.random() < 0.5 ? 1 : -1)\n\n      positions[i3] = Math.cos(branchAngle + spinAngle) * radius + randomX\n      positions[i3 + 1] = randomY\n      positions[i3 + 2] = Math.sin(branchAngle + spinAngle) * radius + randomZ\n\n      // color\n      // we need to clone colorInside because that change the original object\n      const mixedColor = colorInside.clone()\n      mixedColor.lerp(colorOutside, radius / parameters.radius)\n\n      colors[i3] = mixedColor.r\n      colors[i3 + 1] = mixedColor.g\n      colors[i3 + 2] = mixedColor.b\n    }\n    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))\n    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))\n\n    /**\n     * Material\n     */\n\n    material = new THREE.PointsMaterial({\n      size: parameters.size,\n      sizeAttenuation: true,\n      depthWrite: false,\n      blending: THREE.AdditiveBlending,\n      vertexColors: true,\n    })\n\n    /**\n     * Points\n     */\n    points = new THREE.Points(geometry, material)\n    scene.add(points)\n  }\n\n  generateGalaxy()\n\n  gui\n    .add(parameters, 'count')\n    .min(100)\n    .max(1000000)\n    .step(100)\n    .onFinishChange(generateGalaxy)\n  gui\n    .add(parameters, 'size')\n    .min(0.001)\n    .max(0.1)\n    .step(0.001)\n    .onFinishChange(generateGalaxy)\n\n  gui\n    .add(parameters, 'radius')\n    .min(0.01)\n    .max(20)\n    .step(0.01)\n    .onFinishChange(generateGalaxy)\n\n  gui\n    .add(parameters, 'branches')\n    .min(2)\n    .max(20)\n    .step(1)\n    .onFinishChange(generateGalaxy)\n\n  gui\n    .add(parameters, 'spin')\n    .min(-5)\n    .max(5)\n    .step(0.001)\n    .onFinishChange(generateGalaxy)\n  gui\n    .add(parameters, 'randomness')\n    .min(0)\n    .max(2)\n    .step(0.001)\n    .onFinishChange(generateGalaxy)\n\n  gui\n    .add(parameters, 'randomnessPower')\n    .min(1)\n    .max(10)\n    .step(0.001)\n    .onFinishChange(generateGalaxy)\n  gui.addColor(parameters, 'insideColor').onFinishChange(generateGalaxy)\n  gui.addColor(parameters, 'outsideColor').onFinishChange(generateGalaxy)\n  gui\n    .add(parameters, 'rotationSpeed')\n    .min(0)\n    .max(1)\n    .step(0.001)\n    .name('Rotation Speed')\n  /**\n   * Animate\n   */\n  const timer = new Timer()\n  let animationFrameId = null\n\n  console.log('------------------START-------------------')\n  console.log(scene)\n  console.log('--------------------END-------------------')\n\n  const tick = () => {\n    timer.update()\n    const elapsedTime = timer.getElapsed()\n\n    points.rotation.y = elapsedTime * parameters.rotationSpeed\n    renderer.render(scene, camera)\n\n    animationFrameId = window.requestAnimationFrame(tick)\n  }\n\n  tick()\n\n  /**\n   * Cleanup\n   */\n  return function dispose() {\n    if (animationFrameId) {\n      window.cancelAnimationFrame(animationFrameId)\n    }\n    window.removeEventListener('resize', onResize)\n    gui.destroy()\n    renderer.dispose()\n    scene.traverse((child) => {\n      if (child.isMesh) {\n        child.geometry.dispose()\n        if (child.material.isMaterial) {\n          for (const key of Object.keys(child.material)) {\n            const value = child.material[key]\n            if (value && typeof value.dispose === 'function') {\n              value.dispose()\n            }\n          }\n          child.material.dispose()\n        }\n      }\n    })\n  }\n}\n"],"names":["galaxyGenerator","canvas","gui","GUI","scene","THREE.Scene","sizes","onResize","camera","renderer","THREE.PerspectiveCamera","controls","OrbitControls","THREE.WebGLRenderer","parameters","geometry","material","points","generateGalaxy","THREE.BufferGeometry","positions","colors","colorInside","THREE.Color","colorOutside","i","i3","radius","spinAngle","branchAngle","randomX","randomY","randomZ","mixedColor","THREE.BufferAttribute","THREE.PointsMaterial","THREE.AdditiveBlending","THREE.Points","timer","Timer","animationFrameId","tick","elapsedTime","child","key","value"],"mappings":"+JAKe,SAASA,EAAgBC,EAAQ,CAK9C,MAAMC,EAAM,IAAIC,EAAI,CAAE,MAAO,GAAG,CAAE,EAC5BC,EAAQ,IAAIC,EAKZC,EAAQ,CACZ,MAAO,OAAO,WACd,OAAQ,OAAO,WACnB,EAEQC,EAAW,IAAM,CACrBD,EAAM,MAAQ,OAAO,WACrBA,EAAM,OAAS,OAAO,YAEtBE,EAAO,OAASF,EAAM,MAAQA,EAAM,OACpCE,EAAO,uBAAsB,EAE7BC,EAAS,QAAQH,EAAM,MAAOA,EAAM,MAAM,EAC1CG,EAAS,cAAc,KAAK,IAAI,OAAO,iBAAkB,CAAC,CAAC,CAC7D,EAEA,OAAO,iBAAiB,SAAUF,CAAQ,EAK1C,MAAMC,EAAS,IAAIE,EACjB,GACAJ,EAAM,MAAQA,EAAM,OACpB,GACA,GACJ,EACEE,EAAO,SAAS,EAAI,EACpBA,EAAO,SAAS,EAAI,EACpBA,EAAO,SAAS,EAAI,EACpBJ,EAAM,IAAII,CAAM,EAKhB,MAAMG,EAAW,IAAIC,EAAcJ,EAAQP,CAAM,EACjDU,EAAS,cAAgB,GAKzB,MAAMF,EAAW,IAAII,EAAoB,CAAE,OAAAZ,CAAM,CAAE,EACnDQ,EAAS,QAAQH,EAAM,MAAOA,EAAM,MAAM,EAC1CG,EAAS,cAAc,KAAK,IAAI,OAAO,iBAAkB,CAAC,CAAC,EAM3D,MAAMK,EAAa,CACjB,MAAO,IACP,KAAM,IACN,OAAQ,EACR,SAAU,EACV,KAAM,EACN,WAAY,GACZ,gBAAiB,IACjB,YAAa,UACb,aAAc,UACd,cAAe,EACnB,EAEE,IAAIC,EACAC,EACAC,EAEJ,MAAMC,EAAiB,IAAM,CAEvBD,IACFF,EAAS,QAAO,EAChBC,EAAS,QAAO,EAChBZ,EAAM,OAAOa,CAAM,GAMrBF,EAAW,IAAII,EACf,MAAMC,EAAY,IAAI,aAAaN,EAAW,MAAQ,CAAC,EACjDO,EAAS,IAAI,aAAaP,EAAW,MAAQ,CAAC,EAE9CQ,EAAc,IAAIC,EAAYT,EAAW,WAAW,EACpDU,EAAe,IAAID,EAAYT,EAAW,YAAY,EAE5D,QAASW,EAAI,EAAGA,EAAIX,EAAW,MAAOW,IAAK,CACzC,MAAMC,EAAKD,EAAI,EAETE,EAAS,KAAK,OAAM,EAAKb,EAAW,OACpCc,EAAYD,EAASb,EAAW,KAChCe,EACFJ,EAAIX,EAAW,SAAYA,EAAW,SAAY,KAAK,GAAK,EAE1DgB,EACJ,KAAK,IAAI,KAAK,OAAM,EAAIhB,EAAW,eAAe,GACjD,KAAK,OAAM,EAAK,GAAM,EAAI,IACvBiB,EACJ,KAAK,IAAI,KAAK,OAAM,EAAIjB,EAAW,eAAe,GACjD,KAAK,OAAM,EAAK,GAAM,EAAI,IACvBkB,EACJ,KAAK,IAAI,KAAK,OAAM,EAAIlB,EAAW,eAAe,GACjD,KAAK,OAAM,EAAK,GAAM,EAAI,IAE7BM,EAAUM,CAAE,EAAI,KAAK,IAAIG,EAAcD,CAAS,EAAID,EAASG,EAC7DV,EAAUM,EAAK,CAAC,EAAIK,EACpBX,EAAUM,EAAK,CAAC,EAAI,KAAK,IAAIG,EAAcD,CAAS,EAAID,EAASK,EAIjE,MAAMC,EAAaX,EAAY,MAAK,EACpCW,EAAW,KAAKT,EAAcG,EAASb,EAAW,MAAM,EAExDO,EAAOK,CAAE,EAAIO,EAAW,EACxBZ,EAAOK,EAAK,CAAC,EAAIO,EAAW,EAC5BZ,EAAOK,EAAK,CAAC,EAAIO,EAAW,CAC9B,CACAlB,EAAS,aAAa,WAAY,IAAImB,EAAsBd,EAAW,CAAC,CAAC,EACzEL,EAAS,aAAa,QAAS,IAAImB,EAAsBb,EAAQ,CAAC,CAAC,EAMnEL,EAAW,IAAImB,EAAqB,CAClC,KAAMrB,EAAW,KACjB,gBAAiB,GACjB,WAAY,GACZ,SAAUsB,EACV,aAAc,EACpB,CAAK,EAKDnB,EAAS,IAAIoB,EAAatB,EAAUC,CAAQ,EAC5CZ,EAAM,IAAIa,CAAM,CAClB,EAEAC,EAAc,EAEdhB,EACG,IAAIY,EAAY,OAAO,EACvB,IAAI,GAAG,EACP,IAAI,GAAO,EACX,KAAK,GAAG,EACR,eAAeI,CAAc,EAChChB,EACG,IAAIY,EAAY,MAAM,EACtB,IAAI,IAAK,EACT,IAAI,EAAG,EACP,KAAK,IAAK,EACV,eAAeI,CAAc,EAEhChB,EACG,IAAIY,EAAY,QAAQ,EACxB,IAAI,GAAI,EACR,IAAI,EAAE,EACN,KAAK,GAAI,EACT,eAAeI,CAAc,EAEhChB,EACG,IAAIY,EAAY,UAAU,EAC1B,IAAI,CAAC,EACL,IAAI,EAAE,EACN,KAAK,CAAC,EACN,eAAeI,CAAc,EAEhChB,EACG,IAAIY,EAAY,MAAM,EACtB,IAAI,EAAE,EACN,IAAI,CAAC,EACL,KAAK,IAAK,EACV,eAAeI,CAAc,EAChChB,EACG,IAAIY,EAAY,YAAY,EAC5B,IAAI,CAAC,EACL,IAAI,CAAC,EACL,KAAK,IAAK,EACV,eAAeI,CAAc,EAEhChB,EACG,IAAIY,EAAY,iBAAiB,EACjC,IAAI,CAAC,EACL,IAAI,EAAE,EACN,KAAK,IAAK,EACV,eAAeI,CAAc,EAChChB,EAAI,SAASY,EAAY,aAAa,EAAE,eAAeI,CAAc,EACrEhB,EAAI,SAASY,EAAY,cAAc,EAAE,eAAeI,CAAc,EACtEhB,EACG,IAAIY,EAAY,eAAe,EAC/B,IAAI,CAAC,EACL,IAAI,CAAC,EACL,KAAK,IAAK,EACV,KAAK,gBAAgB,EAIxB,MAAMwB,EAAQ,IAAIC,EAClB,IAAIC,EAAmB,KAEvB,QAAQ,IAAI,4CAA4C,EACxD,QAAQ,IAAIpC,CAAK,EACjB,QAAQ,IAAI,4CAA4C,EAExD,MAAMqC,EAAO,IAAM,CACjBH,EAAM,OAAM,EACZ,MAAMI,EAAcJ,EAAM,WAAU,EAEpCrB,EAAO,SAAS,EAAIyB,EAAc5B,EAAW,cAC7CL,EAAS,OAAOL,EAAOI,CAAM,EAE7BgC,EAAmB,OAAO,sBAAsBC,CAAI,CACtD,EAEA,OAAAA,EAAI,EAKG,UAAmB,CACpBD,GACF,OAAO,qBAAqBA,CAAgB,EAE9C,OAAO,oBAAoB,SAAUjC,CAAQ,EAC7CL,EAAI,QAAO,EACXO,EAAS,QAAO,EAChBL,EAAM,SAAUuC,GAAU,CACxB,GAAIA,EAAM,SACRA,EAAM,SAAS,QAAO,EAClBA,EAAM,SAAS,YAAY,CAC7B,UAAWC,KAAO,OAAO,KAAKD,EAAM,QAAQ,EAAG,CAC7C,MAAME,EAAQF,EAAM,SAASC,CAAG,EAC5BC,GAAS,OAAOA,EAAM,SAAY,YACpCA,EAAM,QAAO,CAEjB,CACAF,EAAM,SAAS,QAAO,CACxB,CAEJ,CAAC,CACH,CACF"}
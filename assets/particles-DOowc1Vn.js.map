{"version":3,"file":"particles-DOowc1Vn.js","sources":["../../src/projects/particles.js"],"sourcesContent":["import * as THREE from 'three'\nimport { Timer } from 'three/addons/misc/Timer.js'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\n\nexport default function particles(canvas) {\n  // textures\n\n  const textureLoader = new THREE.TextureLoader()\n  const particleTexture = textureLoader.load('./particles/2.png')\n  console.log(particleTexture)\n\n  /**\n   * Scene\n   */\n  const scene = new THREE.Scene()\n\n  /**\n   * Sizes\n   */\n  const sizes = {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  }\n\n  const onResize = () => {\n    sizes.width = window.innerWidth\n    sizes.height = window.innerHeight\n\n    camera.aspect = sizes.width / sizes.height\n    camera.updateProjectionMatrix()\n\n    renderer.setSize(sizes.width, sizes.height)\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n  }\n\n  window.addEventListener('resize', onResize)\n\n  /**\n   * Camera\n   */\n  const camera = new THREE.PerspectiveCamera(\n    75,\n    sizes.width / sizes.height,\n    0.1,\n    100,\n  )\n  camera.position.z = 3\n  scene.add(camera)\n\n  /**\n   * Controls\n   */\n  const controls = new OrbitControls(camera, canvas)\n  controls.enableDamping = true\n\n  /**\n   * Renderer\n   */\n  const renderer = new THREE.WebGLRenderer({ canvas })\n  renderer.setSize(sizes.width, sizes.height)\n  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n\n  /**\n   * Particle\n   */\n\n  // const particlesGeometry = new THREE.SphereGeometry(1, 32, 32)\n  const particlesGeometry = new THREE.BufferGeometry()\n  const count = 6000\n\n  const positions = new Float32Array(count * 3)\n  const colors = new Float32Array(count * 3)\n\n  for (let i = 0; i < count * 3; i++) {\n    positions[i] = (Math.random() - 0.5) * 10\n    colors[i] = Math.random()\n  }\n\n  particlesGeometry.setAttribute(\n    'position',\n    new THREE.BufferAttribute(positions, 3),\n  )\n  particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))\n\n  const particlesMaterial = new THREE.PointsMaterial({\n    size: 0.02,\n    sizeAttenuation: true,\n    vertexColors: true,\n  })\n  // By default, particles are squares, so we need to make them transparent to see behind them.\n  // Several solutions are viable depending on the use case.\n  particlesMaterial.transparent = true\n  particlesMaterial.alphaMap = particleTexture\n  // When we add alphaMap, it works but we encounter a rendering problem;\n  // it's a bug in the particle rendering order.\n  // every next solutions are ok perf.\n\n  // one solution is to use .alphaTest . That will be great but not perfect.\n  // is you use a circle particle, you can see an small \"halo\" around him.\n  // if your particles moves its ok, but if they are fixe you need another solution\n  // particlesMaterial.alphaTest = 0.001\n\n  // you can use .depthTest\n  // but that can create bugs if you have other objects in your scene or another particles with different colors.\n  // particlesMaterial.depthTest = false\n\n  // The depth of what's being drawn is stored in depth buffer.\n  // instead of not testing if the particle is closer than what's in this depth buffer,\n  // we can tell the webGL not to write particles in that depth buffer with .depthWrite\n  // particlesMaterial.depthWrite = false\n\n  // the last solution is to combining pixels\n  // that give a highlight effect\n  // but can have performance impact.\n  // particlesMaterial.depthWrite = false\n  // particlesMaterial.blending = THREE.AdditiveBlending\n\n  const particles = new THREE.Points(particlesGeometry, particlesMaterial)\n  scene.add(particles)\n\n  /**\n   * Animate\n   */\n  const timer = new Timer()\n  let animationFrameId = null\n\n  const tick = () => {\n    timer.update()\n    const elapsedTime = timer.getElapsed()\n\n    // update particles\n    // particles.rotation.y = elapsedTime * 0.02\n\n    // solution to do a wave\n    // ! Its a bad solutions for more than 50 or 100 particles\n    // const particlesPositionArr = particlesGeometry.attributes.position.array\n    // for (let i = 0; i < count; i++) {\n    //   const i3 = i * 3\n    //   // use x to add a offset\n    //   const x = particlesPositionArr[i3]\n    //   particlesPositionArr[i3 + 1] = Math.sin(elapsedTime + x)\n    // }\n    // particlesGeometry.attributes.position.needsUpdate = true\n\n    // the better solution is to use custom shader to do that.\n\n    controls.update()\n    renderer.render(scene, camera)\n\n    animationFrameId = window.requestAnimationFrame(tick)\n  }\n\n  tick()\n\n  /**\n   * Cleanup\n   */\n  return function dispose() {\n    if (animationFrameId) {\n      window.cancelAnimationFrame(animationFrameId)\n    }\n    window.removeEventListener('resize', onResize)\n    renderer.dispose()\n    scene.traverse((child) => {\n      if (child.isMesh) {\n        child.geometry.dispose()\n        if (child.material.isMaterial) {\n          for (const key of Object.keys(child.material)) {\n            const value = child.material[key]\n            if (value && typeof value.dispose === 'function') {\n              value.dispose()\n            }\n          }\n          child.material.dispose()\n        }\n      }\n    })\n  }\n}\n"],"names":["particles","canvas","particleTexture","THREE.TextureLoader","scene","THREE.Scene","sizes","onResize","camera","renderer","THREE.PerspectiveCamera","controls","OrbitControls","THREE.WebGLRenderer","particlesGeometry","THREE.BufferGeometry","count","positions","colors","i","THREE.BufferAttribute","particlesMaterial","THREE.PointsMaterial","THREE.Points","timer","Timer","animationFrameId","tick","child","key","value"],"mappings":"+GAIe,SAASA,EAAUC,EAAQ,CAIxC,MAAMC,EADgB,IAAIC,EAAmB,EACP,KAAK,mBAAmB,EAC9D,QAAQ,IAAID,CAAe,EAK3B,MAAME,EAAQ,IAAIC,EAKZC,EAAQ,CACZ,MAAO,OAAO,WACd,OAAQ,OAAO,WACnB,EAEQC,EAAW,IAAM,CACrBD,EAAM,MAAQ,OAAO,WACrBA,EAAM,OAAS,OAAO,YAEtBE,EAAO,OAASF,EAAM,MAAQA,EAAM,OACpCE,EAAO,uBAAsB,EAE7BC,EAAS,QAAQH,EAAM,MAAOA,EAAM,MAAM,EAC1CG,EAAS,cAAc,KAAK,IAAI,OAAO,iBAAkB,CAAC,CAAC,CAC7D,EAEA,OAAO,iBAAiB,SAAUF,CAAQ,EAK1C,MAAMC,EAAS,IAAIE,EACjB,GACAJ,EAAM,MAAQA,EAAM,OACpB,GACA,GACJ,EACEE,EAAO,SAAS,EAAI,EACpBJ,EAAM,IAAII,CAAM,EAKhB,MAAMG,EAAW,IAAIC,EAAcJ,EAAQP,CAAM,EACjDU,EAAS,cAAgB,GAKzB,MAAMF,EAAW,IAAII,EAAoB,CAAE,OAAAZ,CAAM,CAAE,EACnDQ,EAAS,QAAQH,EAAM,MAAOA,EAAM,MAAM,EAC1CG,EAAS,cAAc,KAAK,IAAI,OAAO,iBAAkB,CAAC,CAAC,EAO3D,MAAMK,EAAoB,IAAIC,EACxBC,EAAQ,IAERC,EAAY,IAAI,aAAaD,EAAQ,CAAC,EACtCE,EAAS,IAAI,aAAaF,EAAQ,CAAC,EAEzC,QAASG,EAAI,EAAGA,EAAIH,EAAQ,EAAGG,IAC7BF,EAAUE,CAAC,GAAK,KAAK,OAAM,EAAK,IAAO,GACvCD,EAAOC,CAAC,EAAI,KAAK,OAAM,EAGzBL,EAAkB,aAChB,WACA,IAAIM,EAAsBH,EAAW,CAAC,CAC1C,EACEH,EAAkB,aAAa,QAAS,IAAIM,EAAsBF,EAAQ,CAAC,CAAC,EAE5E,MAAMG,EAAoB,IAAIC,EAAqB,CACjD,KAAM,IACN,gBAAiB,GACjB,aAAc,EAClB,CAAG,EAGDD,EAAkB,YAAc,GAChCA,EAAkB,SAAWnB,EAyB7B,MAAMF,EAAY,IAAIuB,EAAaT,EAAmBO,CAAiB,EACvEjB,EAAM,IAAIJ,CAAS,EAKnB,MAAMwB,EAAQ,IAAIC,EAClB,IAAIC,EAAmB,KAEvB,MAAMC,EAAO,IAAM,CACjBH,EAAM,OAAM,EACQA,EAAM,WAAU,EAkBpCb,EAAS,OAAM,EACfF,EAAS,OAAOL,EAAOI,CAAM,EAE7BkB,EAAmB,OAAO,sBAAsBC,CAAI,CACtD,EAEA,OAAAA,EAAI,EAKG,UAAmB,CACpBD,GACF,OAAO,qBAAqBA,CAAgB,EAE9C,OAAO,oBAAoB,SAAUnB,CAAQ,EAC7CE,EAAS,QAAO,EAChBL,EAAM,SAAUwB,GAAU,CACxB,GAAIA,EAAM,SACRA,EAAM,SAAS,QAAO,EAClBA,EAAM,SAAS,YAAY,CAC7B,UAAWC,KAAO,OAAO,KAAKD,EAAM,QAAQ,EAAG,CAC7C,MAAME,EAAQF,EAAM,SAASC,CAAG,EAC5BC,GAAS,OAAOA,EAAM,SAAY,YACpCA,EAAM,QAAO,CAEjB,CACAF,EAAM,SAAS,QAAO,CACxB,CAEJ,CAAC,CACH,CACF"}